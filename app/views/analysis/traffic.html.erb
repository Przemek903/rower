<div class="container-fluid">
  <div class="row bikeRoutes">
    <div class="col-md-1"></div>
    <div class="col-md-10">
      <h3>Mapa przemieszczń</h3>
      <div class="row">
        <div id="map" style='width: 100%; height: 550px;'></div>
    </div>
  </div>
</div>
</div>


<script type="text/javascript">
var center = new google.maps.LatLng(52.2359212,20.996984);
var map = new google.maps.Map(document.getElementById('map'), {
   center: center,
   zoom: 11
});

var infowindow = new google.maps.InfoWindow({
  map: map
});

var bounds = new google.maps.LatLngBounds();

// start coordinates
var start = <%= @startAndLineProperties %>

// end coordinates
var end = <%= @end %>

var lineColor = <%= raw @lineColor.to_json %>

var clusterCount = <%= raw @clusterInfo.to_json %>

function initialize() {
    for (var i=0; i < end.length; i++){

      calcRoute(start[i], end [i], start[i][2], lineColor[i], clusterCount[i]);
    }
}


function calcRoute(source,destination, lineWeight, lineColor, clusterCount){

  var flightPlanCoordinates = [
          {lat: source[0], lng: source[1]},
          {lat: destination[0], lng: destination[1]}
        ];
  var polyline = new google.maps.Polyline({
          path: flightPlanCoordinates,
          geodesic: true,
          strokeColor: lineColor,
          strokeOpacity: 1.0,
          strokeWeight: lineWeight
        });
  polyline.setMap(map);

  var toolTip = '<div id="map-box">'+
 '<div id="siteNotice">'+
 '</div>'+
 '<h3 id="firstHeading" class="firstHeading">Liczba przemieszczeń</h1>'+
 '<div id="bodyContent">'+
 '<p>Kalster A - okolice '+
 clusterCount[4] + '(Liczba stacji: ' + clusterCount[2] + ')' +'</p>'+
 '<p>Klaster B - okolice '+
 clusterCount[5] + '(Liczba stacji: ' + clusterCount[3] + ')' +'</p>'+
 '<p>A -> B - '+
 clusterCount[0] +' przemieszczeń </p>'+
 '<p>B -> A - '+
 clusterCount[1] +' przemieszczeń</p>'+
 '</div>'+
 '</div>';

   var polygons = new google.maps.Polygon({
          paths: <%= raw @kmeans.to_json %>,
          strokeColor: '#858585',
          strokeOpacity: 0.1,
          strokeWeight: 2,
          fillOpacity: 0.01,
          fillColor: "#000000"
        });
        polygons.setMap(map)

  google.maps.event.addListener(polyline, 'click', function(event) {
    infowindow.setContent(toolTip);
    infowindow.setPosition(event.latLng);
    infowindow.open(map);
  });
}
google.maps.event.addDomListener(window, 'load', initialize);


</script>
